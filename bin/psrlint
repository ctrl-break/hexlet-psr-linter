#!/usr/bin/env php
<?php
require_once __DIR__.'/../vendor/autoload.php';

use HexletPsrLinter\Linter;
use HexletPsrLinter\FileInspector;
use Lijinma\Color;

function output($errors)
{
    $counter = 0;
    foreach ($errors as $err) {
        echo Color::LIGHT_GRAY.$err[2]."\t".$err[1]."\t\t";
        echo Color::YELLOW.$err[3].PHP_EOL;
        echo Color::GREEN.$err[0].PHP_EOL;
        ++$counter;
    }
    if ($counter) {
        echo Color::RED.$counter.' problems';
    } else {
        echo 'ok';
    }
}

$file = new FileInspector($argv[1]);

if ($file->getError() === false) {
    $linter = new Linter($file->getCode());
    output($linter->linter());
} else {
    echo Color::RED.$file->getError();
}

echo PHP_EOL;
