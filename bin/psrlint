#!/usr/bin/env php

<?php
require_once __DIR__.'/../vendor/autoload.php';

use HexletPsrLinter\Linter;

function output($errors)
{
    $counter = 0;
    foreach ($errors as $err) {
        printf('%s:%-14s', $err[2]['startLine'], $err[1]);
        printf('%-17s', "\033[35m".$err[3]."\033[0m");
        printf('%-55s', $err[0]);
        echo PHP_EOL;
        ++$counter;
    }
    if ($counter) {
        echo "\033[31m".$counter.' problems';
    } else {
        echo 'ok';
    }
}

if (file_exists($argv[1])) {
    $file = new SplFileInfo($argv[1]);

    if ($file->getExtension() !== 'php') {
        echo 'File must have php extension';
    } else {
        $code = file_get_contents($file);
        $checker = new Linter($code);
        output($checker->linter());
    };
} else {
    echo "File doesn't exist";
}

echo PHP_EOL;
