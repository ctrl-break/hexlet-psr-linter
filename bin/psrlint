#!/usr/bin/env php
<?php
require_once __DIR__.'/../vendor/autoload.php';

use HexletPsrLinter\Linter;
use Lijinma\Color;

function output($errors)
{
    $counter = 0;
    foreach ($errors as $err) {
        echo Color::LIGHT_GRAY.$err[2]."\t".$err[1]."\t\t";
        echo Color::YELLOW.$err[3].PHP_EOL;
        echo Color::GREEN.$err[0].PHP_EOL;
        ++$counter;
    }
    if ($counter) {
        echo Color::RED.$counter.' problems';
    } else {
        echo 'ok';
    }
}

if (file_exists($argv[1])) {
    $file = new SplFileInfo($argv[1]);

    if ($file->getExtension() !== 'php') {
        echo 'File must have php extension';
    } else {
        $code = file_get_contents($file);
        $checker = new Linter($code);
        output($checker->linter());
    };
} else {
    echo "File doesn't exist";
}

echo PHP_EOL;
