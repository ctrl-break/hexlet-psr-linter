#!/usr/bin/env php
<?php

require_once __DIR__.'/../vendor/autoload.php';

use Commando\Command;
use HexletPsrLinter as hpl;

$cmd = new Command();

$cmd->option()
    ->aka('path')
    ->require()
    ->describedAs('File path');

$cmd->option('f')
    ->aka('fix')
    ->boolean()
    ->default(false)
    ->describedAs('Fix files errors');

$cmd->option('rf')
    ->aka('reportFormat')
    ->must(function($format) {
            $formats = array('text', 'json', 'yaml');
            return in_array($format, $formats);
        })
    ->describedAs('Report format: text, json, yaml');

$result = hpl\run($cmd['path'],
                  ['fix' => $cmd['fix'],
                   'format' => $cmd['reportFormat'],
                  ]);

if (!empty($result)) {
    $exitCode = 1;
    hpl\printResult($result);
} else {
    $exitCode = 0;
    echo "\nAll files are correct.\n";
}
//eval(\Psy\sh());
exit($exitCode);
